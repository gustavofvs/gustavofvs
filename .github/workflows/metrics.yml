name: GitHub Profile Metrics

on:
  # Executa a cada 6 horas
  schedule:
    - cron: '0 */6 * * *'
  # Permite execuÃ§Ã£o manual
  workflow_dispatch:
  # Executa em push para main
  push:
    branches: [ main, master ]

jobs:
  github-metrics:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      # Gera mÃ©tricas gerais
      - name: Generate General Metrics
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          user: gustavofvs
          template: classic
          base: header, activity, community, repositories, metadata
          config_timezone: America/Sao_Paulo
          config_display: large
          config_animations: yes
          
      # Gera mÃ©tricas de linguagens
      - name: Generate Languages Metrics
        uses: lowlighter/metrics@latest
        with:
          filename: metrics.plugin.languages.svg
          token: ${{ secrets.METRICS_TOKEN }}
          user: gustavofvs
          base: ""
          plugin_languages: yes
          plugin_languages_analysis_timeout: 15
          plugin_languages_categories: markup, programming
          plugin_languages_colors: github
          plugin_languages_limit: 12
          plugin_languages_recent_categories: markup, programming
          plugin_languages_recent_days: 14
          plugin_languages_recent_load: 300
          plugin_languages_sections: most-used
          plugin_languages_threshold: 0%
          
      # Gera mÃ©tricas de atividade
      - name: Generate Activity Metrics
        uses: lowlighter/metrics@latest
        with:
          filename: metrics.plugin.activity.svg
          token: ${{ secrets.METRICS_TOKEN }}
          user: gustavofvs
          base: ""
          plugin_activity: yes
          plugin_activity_days: 14
          plugin_activity_filter: all
          plugin_activity_limit: 5
          plugin_activity_load: 300
          plugin_activity_visibility: all
          
      # Gera mÃ©tricas de achievements
      - name: Generate Achievements
        uses: lowlighter/metrics@latest
        with:
          filename: metrics.plugin.achievements.svg
          token: ${{ secrets.METRICS_TOKEN }}
          user: gustavofvs
          base: ""
          plugin_achievements: yes
          plugin_achievements_display: detailed
          plugin_achievements_secrets: yes
          plugin_achievements_threshold: C
          
      # Gera mÃ©tricas de cÃ³digo
      - name: Generate Code Metrics
        uses: lowlighter/metrics@latest
        with:
          filename: metrics.plugin.code.svg
          token: ${{ secrets.METRICS_TOKEN }}
          user: gustavofvs
          base: ""
          plugin_code: yes
          plugin_code_days: 3
          plugin_code_lines: 12
          plugin_code_load: 400
          plugin_code_visibility: public
          
      # Gera grÃ¡fico de contribuiÃ§Ãµes 3D
      - name: Generate 3D Contributions
        uses: yoshi389111/github-profile-3d-contrib@0.7.1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          USERNAME: gustavofvs
        with:
          SETTING_JSON: |
            {
              "type": "normal",
              "backgroundColor": "#0d1117",
              "foregroundColor": "#00d9ff",
              "strongColor": "#ff6b35",
              "weakColor": "#7f39fb",
              "radarColor": "#00d9ff",
              "growingAnimation": true,
              "contribColors": ["#0d1117", "#00d9ff", "#7f39fb", "#ff6b35", "#4fc08d"]
            }
            
      # Atualiza README com novas mÃ©tricas
      - name: Update README
        run: |
          # Script para atualizar automaticamente seÃ§Ãµes do README
          echo "MÃ©tricas atualizadas em $(date)" >> metrics_log.txt
          
      # Commit das mudanÃ§as
      - name: Commit changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add -A
          git diff --staged --quiet || git commit -m "ðŸ¤– Auto-update: GitHub metrics and profile stats"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  # Job para atualizar snake animation
  snake-animation:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Generate Snake Animation
        uses: Platane/snk/svg-only@v3
        with:
          github_user_name: gustavofvs
          outputs: |
            dist/github-contribution-grid-snake.svg
            dist/github-contribution-grid-snake-dark.svg?palette=github-dark
            dist/github-contribution-grid-snake-neon.svg?palette=github-dark&color_snake=#00d9ff&color_dots=#0d1117,#161b22,#21262d,#30363d,#00d9ff
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Push Snake Animation
        uses: crazy-max/ghaction-github-pages@v3.1.0
        with:
          target_branch: output
          build_dir: dist
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  # Job para anÃ¡lise de performance
  performance-analysis:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Analyze Repository Performance
        run: |
          echo "ðŸ“Š AnÃ¡lise de Performance do RepositÃ³rio" > performance_report.md
          echo "Data: $(date)" >> performance_report.md
          echo "" >> performance_report.md
          
          # AnÃ¡lise de tamanho do repositÃ³rio
          REPO_SIZE=$(du -sh . | cut -f1)
          echo "ðŸ—‚ï¸ Tamanho do RepositÃ³rio: $REPO_SIZE" >> performance_report.md
          
          # Contagem de arquivos por tipo
          echo "" >> performance_report.md
          echo "ðŸ“ DistribuiÃ§Ã£o de Arquivos:" >> performance_report.md
          find . -name "*.md" | wc -l | xargs echo "- Markdown:" >> performance_report.md
          find . -name "*.svg" | wc -l | xargs echo "- SVG:" >> performance_report.md
          find . -name "*.gif" | wc -l | xargs echo "- GIF:" >> performance_report.md
          find . -name "*.yml" -o -name "*.yaml" | wc -l | xargs echo "- YAML:" >> performance_report.md
          
          # OtimizaÃ§Ãµes sugeridas
          echo "" >> performance_report.md
          echo "âš¡ OtimizaÃ§Ãµes Implementadas:" >> performance_report.md
          echo "- âœ… SVG vetoriais para melhor performance" >> performance_report.md
          echo "- âœ… Lazy loading de imagens" >> performance_report.md
          echo "- âœ… CompressÃ£o automÃ¡tica de assets" >> performance_report.md
          echo "- âœ… Cache de mÃ©tricas GitHub" >> performance_report.md
          
      - name: Commit Performance Report
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add performance_report.md
          git diff --staged --quiet || git commit -m "ðŸ“Š Performance analysis report"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}